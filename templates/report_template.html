{% extends "base.html" %}

{% block title %}Research Report: {{ title }}{% endblock %}

{% block report_title %}Research Report: {{ title }}{% endblock %}

{% block content %}
    <div class="section no-print" id="table-of-contents">
        <h2>Table of Contents</h2>
        <ul class="toc">
            {% for section in sections %}
                <li><a href="#{{ section.title|lower|replace(' ', '-') }}">{{ section.title }}</a></li>
            {% endfor %}
        </ul>
    </div>

    {% for section in sections %}
        <div class="section" id="{{ section.title|lower|replace(' ', '-') }}">
            <h2>{{ section.title }}</h2>
            {{ section.content|safe }}
        </div>
    {% endfor %}
    
    <div class="no-print">
        <hr>
        <p><em>This report was generated automatically. For the most up-to-date information, please ensure you have the latest version.</em></p>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // Add smooth scrolling for table of contents links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                window.scrollTo({
                    top: target.offsetTop - 20,
                    behavior: 'smooth'
                });
                
                // Update URL without page jump
                if (history.pushState) {
                    history.pushState(null, null, this.getAttribute('href'));
                }
            }
        });
    });

    // Add print button functionality
    document.addEventListener('DOMContentLoaded', function() {
        const header = document.querySelector('header');
        
        // Create button container
        const buttonContainer = document.createElement('div');
        buttonContainer.style.marginTop = '15px';
        buttonContainer.style.display = 'flex';
        buttonContainer.style.gap = '10px';
        
        // Print button
        const printButton = document.createElement('button');
        printButton.textContent = 'Print Report';
        printButton.style.cssText = `
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        `;
        
        // Add hover effect
        printButton.onmouseover = () => printButton.style.backgroundColor = '#2980b9';
        printButton.onmouseout = () => printButton.style.backgroundColor = '#3498db';
        
        printButton.onclick = () => window.print();
        
        // Back to top button
        const topButton = document.createElement('button');
        topButton.textContent = 'Back to Top';
        topButton.style.cssText = printButton.style.cssText;
        topButton.style.background = '#6c757d';
        topButton.onmouseover = () => topButton.style.backgroundColor = '#5a6268';
        topButton.onmouseout = () => topButton.style.backgroundColor = '#6c757d';
        topButton.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Add buttons to container
        buttonContainer.appendChild(printButton);
        buttonContainer.appendChild(topButton);
        
        // Add container to header
        header.appendChild(buttonContainer);
        
        // Show/hide back to top button on scroll
        window.onscroll = function() {
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                topButton.style.display = 'block';
            } else {
                topButton.style.display = 'none';
            }
        };
    });
</script>
{% endblock %}
